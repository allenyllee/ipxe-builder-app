<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>iPXE EFI Builder</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <main class="container">
      <h1>iPXE EFI Builder</h1>
      <p>
        GitHub Pages 前端 + Cloudflare Worker + GitHub App。使用者在自己的 fork repo
        觸發 build，成功後自動下載，並保留一段時間供手動重抓後再清理 artifact。
      </p>

      <section class="card">
        <label for="apiBase">Worker API Base URL</label>
        <input id="apiBase" type="text" placeholder="https://ipxe-builder-api.<subdomain>.workers.dev" />

        <div class="actions">
          <button id="loginBtn">GitHub App Login/Install</button>
          <button id="switchInstallBtn" class="secondary">Switch Fork/Installation</button>
          <button id="logoutBtn" class="secondary">Logout</button>
          <button id="clearCacheBtn" class="secondary">Clear All Cache</button>
        </div>

        <div id="userInfo" class="status">尚未登入。</div>
        <div id="templateInfo" class="status">Template: 載入中...</div>
        <div id="setupTips" class="status" hidden></div>

        <label for="script">iPXE Script</label>
        <textarea id="script" rows="14" spellcheck="false">#!ipxe

dhcp
chain http://boot.ipxe.org/demo/boot.php
</textarea>

        <label for="rootCertFile">Optional Root CA Certificates (PEM, multiple)</label>
        <input id="rootCertFile" type="file" accept=".crt,.pem,.cer,text/plain" multiple />
        <div id="rootCertInfo" class="status">未上傳 Root CA，將使用系統預設信任。</div>

        <div class="actions">
          <button id="forkBtn" class="secondary">Check Fork Access</button>
          <button id="buildBtn">Build + Auto Download</button>
          <button id="checkBtn" class="secondary">Check Latest Run</button>
          <button id="cleanupBtn" class="secondary">Clean Now</button>
        </div>

        <div id="downloadInfo" class="status">尚無下載連結。</div>

        <pre id="log" class="log">準備就緒。</pre>
      </section>
    </main>

    <script type="module" src="./app.js"></script>
    <div id="setupOverlay" class="overlay" hidden>
      <div class="overlay-card">
        <h2>Setup Assistant</h2>
        <div id="setupOverlayStatus" class="status">準備中...</div>
        <div id="setupOverlayActions" class="actions"></div>
        <div class="actions">
          <button id="setupOverlayClose" class="secondary">關閉</button>
        </div>
      </div>
    </div>
  </body>
</html>
